obj-m := foobar.o
ccflags-y  += -O0 -g

ARM_CROSS_COMPILE=~/Android/Sdk/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-
ARM64_CROSS_COMPILE=~/Android/Sdk/ndk-bundle/toolchains/aarch64-linux-android-4.9/prebuilt/linux-x86_64/bin/aarch64-linux-android-
LINUX_DIR=/lib/modules/$(shell uname -r)/build
ANDROID_LINUX_DIR=~/Workspace/android-source/linux-android-msm

all: local android-arm64

local:
	make ARCH=x86_64 -C $(LINUX_DIR) M=`pwd` modules
	sudo rmmod foobar || true
	sudo insmod foobar.ko

android-arm64:
	make ARCH=arm64 CROSS_COMPILE=$(ARM64_CROSS_COMPILE) -C $(ANDROID_LINUX_DIR) M=`pwd` modules
	adb shell rmmod foobar || true
	adb push foobar.ko /data
	adb shell insmod /data/foobar.ko


clean:
	make -C /lib/modules/$(shell uname -r)/build M=`pwd` clean

